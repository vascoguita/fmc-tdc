-------------------------------------------------------------------------------
-- acam_test.vec
-------------------------------------------------------------------------------
-- Select the GN4124 Primary BFM
model 0

-- Initialize the BFM to its default state
init

-------------------------------------------------------------------------------
-- Initialize the Primary GN412x BFM model
-------------------------------------------------------------------------------
-- These address ranges will generate traffic from the BFM to the FPGA
-- bar BAR ADDR SIZE VC TC S
bar     0 0000000000000000 00100000 0 7 0

-- This allocates a RAM block inside the BFM for the FPGA to access
-- bfm_bar BAR ADDR SIZE
bfm_bar 0 0000000040000000 20000000
bfm_bar 1 0000000020000000 20000000

-- Drive reset to the FPGA
reset %d320
-- Wait until the FPGA is un-reset and ready for traffic on the local bus
wait   %d50000

-- Drive reset to the FPGA
reset %d320
-- Wait until the FPGA is un-reset and ready for traffic on the local bus
wait   %d60000

-------------------------------------------------------------------------------
-- Access the tdc core register space
-------------------------------------------------------------------------------
-- the following writes will go out in a single packet

---- Gonzalo: 3 writings outside of the BAR defined memory space to check that 
---- the BFM model does not forward them to the Local bus
--wr 0000000040000808 F 0001F04C
--wait   %d20
--wr 0000000040000800 F 00021040
--wait   %d20
--wr 0000000040000800 F 00025000
--wait   %d60

---- Gonzalo: 3 reads inside Matthieu's core memory space to check that the core
---- does not forward them to the wishbone bus
--rd 0000000000000000 F 0000A0A1
--wait   %d20
--rd 0000000000000004 F 0000A0A2
--wait   %d20
--rd 0000000000000008 F 0000A0A3
--wait   %d60

-- Gonzalo: actual wr and rd on the application memory space for test
-- writing stuff on the TDC config
--wr 0000000000051000 F 00000040
--wait   %d20
--wr 0000000000051004 F 00000000
--wait   %d20
--wr 0000000000051008 F 00000000
--wait   %d60

-- writing stuff for the ACAM config
wr 0000000000051000 F 01F0FC81
wait   %d20
wr 0000000000051004 F 00000000
wait   %d20
wr 0000000000051008 F 00000E02
wait   %d60

-- loading the utc time
wr 00000000000510FC F 00000200
wait   %d200

-- loading the acam config
wr 000000000005100FC F 00000004
wait   %d200

-- reading back the acam config
wr 00000000000510FC F 00000008
wait   %d200

-- activate acquisition
wr 00000000000510FC F 00000001
wait   %d540000

-- read circular buffer wr pointer
rd 00000000000510A8 F 00000000
wait   %d200


-- deactivate acquisition
wr 00000000000510FC F 00000002
wait   %d200


-- read a timestamps from memory
rd 0000000000054000 F 00000000
wait   %d100
rd 0000000000054004 F 00000000
wait   %d100
rd 0000000000054008 F 00000000
wait   %d100
rd 000000000005400C F 00000000
wait   %d100


-- read acam status
wr 00000000000510FC F 00000010
wait   %d100
rd 0000000000051070 F 00000000
wait   %d100

-- read acam ififo1
wr 00000000000510FC F 00000020
wait   %d100
rd 0000000000051060 F 00000000
wait   %d100

-- read acam ififo2
wr 00000000000510FC F 00000040
wait   %d100
rd 0000000000051064 F 00000000
wait   %d100

-- read acam start01 register
wr 00000000000510FC F 00000080
wait   %d100
rd 0000000000051068 F 00000000
wait   %d100

-- reset acam
wr 00000000000510FC F 00000100
wait   %d200

--rd 0000000000051000 F 00001234
--wait   %d20
--rd 0000000000051004 F 00005678
--wait   %d20
--rd 0000000000051008 F 0000abcd
--wait   %d20
--rd 000000000005100C F 0000ef90
--wait   %d60
--
--wr 00000000000510FC F 00000001
--wait   %d100
--wr 00000000000510FC F 00000002
--wait   %d100

